# Теория

## Основные проблемы
- неодинаковость окружений, в которых запускается и работает код. Окружение включает системные библиотеки, версии програмного обеспечения, например, версии python, версии установленных модулей python, переменные среды, привелегии пользователя и многое другое
- изоляция работы одного приложения от других. Одна программа может иметь модули python, которые не будут совместимы с версией другой программы. Например. Одна программа требует `pandas>=1.3.0`, а другая `pandas<=0.9.4` , такие программы не могут быть запущенны вместе в одном окружении
- настройка окружений на разных рабочих машинах не всегда может быть простым. К примеру, на ноутбуке у вас стоит ubuntu linux в wsl2, а на сервере, на котором стоят GPU и на котором вы хотите запустить расчеты стоит Red Hat. Настройка на разных дистрибутивов Linux будет немного отличаться, в результате настройка окружения займет больше времени
- если у вас очень много рабочих машин, например много серверов, установка на каждый из них необходимые модули python может оказаться очень долгим занятием


## Способы решения
1. использовать универсальный скрипт установки среды (такой скрипт придется писать с учетом разных дистрибутивах Linux, на которых скрипт будет устанавливаться, все усложняя учитываю, что на данный момент 275 дистрибутивов (на момент 2021 года), при этом линукс существует ~30 лет, грубо можно сказать, что на свет появляется около 9 новых дистрибутивов в год)
1. использовать requirements.txt + venv (что делать, если на сервере или на вашей машине  не установлен python, а некоторые библиотеки, например selenium потребует еще установть Java машину)
1. использовать VM VirtualBox - но из-за этого мы можем значительно дольше считать из-за затрат на визуализацию и не всегда будет простой задачей создать VM с выделенным GPU
1. использовать контейнерные технологии, например Docker


## Почему Docker?
Как минимум потому что он лишен большинства минусов всех остальных подходов:
1. docker container привязан только к версии ядра системы Linux, оно достаточно стабильное, чтобы редко сталкиваться с проблемами - случаи, когда приложение не может корректно работать на определенной версии ядра. Чтобы гарантировать повторяемую работу приложения, достаточно чтобы у разных дистрибутивов Linux были одинаковые ядра.
2. docker container может быть запущен с уже преустановленными программами, включая праавильные Java машину, модули python и многое другое.
3. С точки нагрузки на GPU/CPU/RAM Docker не добавляет overhead-a
4. Docker стал очень популярным и на данный момент де-факто является стандартом.

Ниже схематично представленна контейнеризация vs виртуализация.
Контейнеризация похоже на виртуализацию, но это не одно и то же. Виртуализация работает как отдельный компьютер, со своим виртуальным оборудованием и операционной системой. При этом внутри одной ОС можно запустить другую ОС. В случае контейнеризации виртуальная среда запускается прямо из ядра основной операционной системы и не виртуализирует оборудование. Это означает, что контейнер может работать только в той же ОС, что и основная. При этом так как контейнеры не виртуализируют оборудование, они потребляют намного меньше ресурсов.
![Container_vs_VM](Container_VM_Implementation.png)
## Архитектура Docker и основные понятия
см [источник](https://eternalhost.net/blog/razrabotka/chto-takoe-docker)

Разработка Docker была начата в 2008 году, а в 2013 году он был опубликован как свободно распространяемое ПО под лицензией Apache 2.0. В качестве тестового приложения Docker был включен в дистрибутив Red Hat Enterprise Linux 6.5. В 2017 году была выпущена коммерческая версия Docker с расширенными возможностями.

Docker работает в Linux, ядро которых поддерживает cgroups, а также изоляцию пространства имен. Для инсталляции и использования на платформах, отличных от Linux, существуют специальные утилиты Kitematic или Docker Machine.

Основной принцип работы Docker — контейнеризация приложений. Этот тип виртуализации позволяет упаковывать программное обеспечение по изолированным средам — контейнерам. Каждый из этих виртуальных блоков содержит все нужные элементы для работы приложения. Это дает возможность одновременного запуска большого количества контейнеров на одном хосте.

Основные понятия:

1. Docker-демон (Docker-daemon) — сервер контейнеров, входящий в состав программных средств Docker. Демон управляет Docker-объектами (сети, хранилища, образы и контейнеры). Демон также может связываться с другими демонами для управления сервисами Docker.
1. Docker-клиент (Docker-client / CLI) — интерфейс взаимодействия пользователя с Docker-демоном. Клиент и Демон — важнейшие компоненты «движка» Докера (Docker Engine). Клиент Docker может взаимодействовать с несколькими демонами.
1. Docker-образ (Docker-image) — файл, включающий зависимости, сведения, конфигурацию для дальнейшего развертывания и инициализации контейнера.
1. Docker-файл (Docker-file) — описание правил по сборке образа, в котором первая строка указывает на базовый образ. Последующие команды выполняют копирование файлов и установку программ для создания определенной среды для разработки.
1. Docker-контейнер (Docker-container) — это легкий, автономный исполняемый пакет программного обеспечения, который включает в себя все необходимое для запуска приложения: код, среду выполнения, системные инструменты, системные библиотеки и настройки.
1. Том (Volume) — эмуляция файловой системы для осуществления операций чтения и записи. Она создается автоматически с контейнером, поскольку некоторые приложения осуществляют сохранение данных.
1. Реестр (Docker-registry) — зарезервированный сервер, используемый для хранения docker-образов. Примеры реестров:

   - Центр Docker — реестр, используемый для загрузки docker-image. Он обеспечивает их размещение и интеграцию с GitHub и Bitbucket.
   - Контейнеры Azure — предназначен для работы с образами и их компонентами в директории Azure (Azure Active Directory).
   - Доверенный реестр Docker или DTR — служба docker-реестра для инсталляции на локальном компьютере или сети компании.
1. Docker-хаб (Docker-hub) или хранилище данных — репозиторий, предназначенный для хранения образов с различным программным обеспечением. Наличие готовых элементов влияет на скорость разработки.
1. Docker-хост (Docker-host) — машинная среда для запуска контейнеров с программным обеспечением.
1. Docker-сети (Docker-networks) — применяются для организации сетевого интерфейса между приложениями, развернутыми в контейнерах.


![arch](Docker_Architecture.png)

Преимущества использования Docker
1. Минимальное потребление ресурсов — контейнеры не виртуализируют всю операционную систему (ОС), а используют ядро хоста и изолируют программу на уровне процесса. Последний потребляет намного меньше ресурсов локального компьютера, чем виртуальная машина.
1. Скоростное развертывание — вспомогательные компоненты можно не устанавливать, а использовать уже готовые docker-образы (шаблоны). Например, не имеет смысла постоянно устанавливать и настраивать Linux Ubuntu. Достаточно 1 раз ее инсталлировать, создать образ и постоянно использовать, лишь обновляя версию при необходимости.
1. Удобное скрытие процессов — для каждого контейнера можно использовать разные методы обработки данных, скрывая фоновые процессы.
1. Работа с небезопасным кодом — технология изоляции контейнеров позволяет запускать любой код без вреда для ОС.
1. Простое масштабирование — любой проект можно расширить, внедрив новые контейнеры.
1. Удобный запуск — приложение, находящееся внутри контейнера, можно запустить на любом docker-хосте.
1. Оптимизация файловой системы — образ состоит из слоев, которые позволяют очень эффективно использовать файловую систему.





TODO:
- Теория
  - [X] проблемы
  - [X] основные способы решения
  - [X] почему докер
  - [X] архитектура основные понятия
- Простая практика
  - [ ] основные команды
  - [ ] минимальные докер файл
  - [ ] основные конвенции (включая как и где хранят докер файлы)
  - [ ] получение образов, использования
- Примеры на наших задачах:
  - [ ] установка силениума
  - [ ] базы данных
  - [ ] разворачивания минимального веб приложения
- Продвинутая практика
  - [ ] docker-compose/docker compose
  - [ ] терминалогия/основные понятия
  - [ ] создание сетей, поров, переписывание yml файлов
  - [ ] пример на DREAM (без запусков)
- Примеры на наших задачах:
  - [ ] разворачивание базы данных с сайтом, nginx и так далее